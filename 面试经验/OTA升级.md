OTA（Over-the-Air）升级是通过无线方式（如Wi-Fi、移动网络等）向设备（如汽车、智能手机、物联网设备等）推送和安装软件更新的一种方法。以下是典型的OTA升级基本流程：

## 1.准备阶段
### 1.1 确定更新的内容
+ 确定需要更新的软件版本
+ 生成更新包，包括固件、软件应用程序、配置文件等。

### 1.2 测试和验证
+ 在实验室环境中对更新包进行全面测试和验证，确保其稳定性和兼容性。
+ 进行回滚测试，确保在更新失败时能够安全恢复到之前的版本。

## 2.分发阶段
### 2.1 上传更新包
+ 将经过验证的更新包上传到OTA服务器
+ 配置OTA服务器，包括更新包的版本信息、适用设备类型、发布策略

### 2.2 通知设备
+ 通过推送通知、设备定期检查等方式通知目标设备有可用更新。

## 3.下载阶段
### 3.1 下载更新包
+ 设备接收到更新通知后，通过OTA协议向OTA服务器请求下载更新包。
+ 下载过程中可以使用断点续传技术，确保下载过程的稳定性。

#### 断点续传技术
是一种在网络传输过程中用于应对连接中断或网络不稳定的技术。它允许文件下载或上传在中途中断后，可以从中断的位置继续进行，而不是重新开始传输整个文件。这种技术在大文件传输或网络环境不佳时尤为重要，提高了传输效率和用户体验。
#### 断点续传的基本原理
断点续传的实现依赖于以下几个关键步骤：

+ 分块传输：文件被分成多个小块，每个小块单独进行传输和确认。这样即使某一个块传输失败，也只需要重新传输该块。
+ 记录进度：传输过程中，客户端和服务器会记录当前已成功传输的块的偏移量（即文件的当前位置）。当传输中断时，可以从这个偏移量继续传输。
+ 恢复传输：当连接恢复后，客户端向服务器发送已传输的最后一个块的偏移量，服务器从该偏移量开始继续传输剩余的部分。

#### UDS 36服务的断点续传原理

### 3.2 校验更新包
+ 下载完成后，对更新包进行校验（如使用MD5或SHA-256校验）以确保下载过程中没有数据损坏。

## 4. 安装阶段
### 4.1 准备安装
+ 设备确认更新包校验通过后，准备进行安装。通常会提示用户进行确认，或在用户闲置时自动进行。

### 4.2 备份和回滚
+ 在安装前，对关键数据和当前软件版本进行备份，以便在安装失败时能够回滚。
+ 确保设备在更新过程中具有足够的电量和网络连接，避免中途断电或网络中断。

### 4.3 安装更新
+ 设备进入更新模式（如重启进入引导模式或维护模式）。
+ 安装更新包中的新版本软件或固件。

## 5. 验证和完成阶段
### 5.1 验证安装
+ 安装完成后，设备重新启动并进入新版本软件的运行环境。
+ 进行基本的自检和验证，确保新版本正常运行。

### 5.2 清理和回收
+ 安装成功后，清理临时文件和旧版本备份文件（如果不需要回滚）。
+ 更新安装状态，并向OTA服务器报告成功完成更新。

### 5.3 用户通知
+ 如果是用户触发的更新，向用户通知更新完成，并提供新版本的功能和改进说明。

## 6. UDS 的升级过程
### 预编程阶段：做好编程前的网络准备
1. `10 03`：启动扩展会话模式
2. `31 01 02 02`：检查ECU预编程条件，
3. `85 02`: 关闭DTC
4. `28 03 03`: 禁止非诊断报文的发送和接收
5. `22 xx yy`: 读取 应用软件信息，bootloader信息，vin码，fingerprint记录

### 编程进行阶段：下载程序和数据
1. `10 02`: 进入programming 会话控制
2. `27 07/08`: 通过 security level 07
3. `34`: 请求下载
4. `36`: 传输数据
5. `37`: 请求传输退出
6. `31 01 02 01`: 检查下载逻辑块的完整性
7. `31 01 ff 01`: 
8. `31 01 ff 00`：

9. `11 01`：硬复位
### 后编程阶段：重同步网络
1. `10 01`：进出默认会话控制
2. `22 xx yy`：读取升级后的数据

## 